"use strict";(()=>{var p="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";function S(){return`tz1${Array.from({length:33},()=>p[Math.random()*p.length|0]).join("")}`}function b(t){if(t.length!==36||!/^(tz|KT)[1-4]/.test(t))return!1;for(let r=0;r<t.length;r++)if(!p.includes(t[r]))return!1;return!0}function A(t){return/^(0x)?[0-9a-fA-F]{40}$/.test(t)}function T(){return`oo${Array.from({length:49},()=>p[Math.random()*p.length|0]).join("")}`}function P(t){return/^(0x)?([A-Fa-f0-9]{64})$/.test(t)}function O(t){return[...t].reduce(function(r,e){return r*p.length+p.indexOf(e)|0},0)}function j([t,r,e,n]){return function(){t|=0,r|=0,e|=0,n|=0;let s=(t+r|0)+n|0;return n=n+1|0,t=r^r>>>9,r=e+(e<<3)|0,e=e<<21|e>>>11,e=e+s|0,(s>>>0)/4294967296}}function I(t,r,e=O){let n=t.slice(r).match(new RegExp(".{"+(t.length-r>>2)+"}","g"));return n?n.map(e):[]}function U(t){return P(t)||A(t)?I(t,2,r=>Number(BigInt(`0x${r}`)%BigInt(4294967295))):b(t)?I(t,3):I(t,2)}function g(t){let r=U(t);return j(r)}function B(t){let r=t.replace("#","");return r.length===6&&(r=`${r}ff`),r.length===3&&(r=`${r[0]}${r[0]}${r[1]}${r[1]}${r[2]}${r[2]}ff`),r}var H=function(t){let r="";for(let e=0;e<t.length;e++)r+=t.charCodeAt(e).toString(16).padStart(4,"0");return r},C=function(t){let r=t.match(/.{1,4}/g)||[],e="";for(let n=0;n<r.length;n++){let s=parseInt(r[n],16);if(s===0)break;e+=String.fromCharCode(s)}return e},R=BigInt("-9223372036854775808"),V=BigInt("9223372036854775807"),h={number:{serialize:t=>{let r=new DataView(new ArrayBuffer(8));return r.setFloat64(0,t),r.getBigUint64(0).toString(16).padStart(16,"0")},deserialize:t=>{let r=new DataView(new ArrayBuffer(8));for(let e=0;e<8;e++)r.setUint8(e,parseInt(t.substring(e*2,e*2+2),16));return r.getFloat64(0)},bytesLength:()=>8,constrain:(t,r)=>{var e,n,s,o;let i=Number.MIN_SAFE_INTEGER;typeof((e=r.options)==null?void 0:e.min)<"u"&&(i=Number(r.options.min));let u=Number.MAX_SAFE_INTEGER;typeof((n=r.options)==null?void 0:n.max)<"u"&&(u=Number(r.options.max)),u=Math.min(u,Number.MAX_SAFE_INTEGER),i=Math.max(i,Number.MIN_SAFE_INTEGER);let l=Math.min(Math.max(t,i),u);if((s=r?.options)!=null&&s.step){let d=1/((o=r?.options)==null?void 0:o.step);return Math.round(l*d)/d}return l},random:t=>{var r,e,n,s;let o=Number.MIN_SAFE_INTEGER;typeof((r=t.options)==null?void 0:r.min)<"u"&&(o=Number(t.options.min));let i=Number.MAX_SAFE_INTEGER;typeof((e=t.options)==null?void 0:e.max)<"u"&&(i=Number(t.options.max)),i=Math.min(i,Number.MAX_SAFE_INTEGER),o=Math.max(o,Number.MIN_SAFE_INTEGER);let u=Math.random()*(i-o)+o;if((n=t?.options)!=null&&n.step){let l=1/((s=t?.options)==null?void 0:s.step);return Math.round(u*l)/l}return u}},bigint:{serialize:t=>{let r=new DataView(new ArrayBuffer(8));return r.setBigInt64(0,BigInt(t)),r.getBigUint64(0).toString(16).padStart(16,"0")},deserialize:t=>{let r=new DataView(new ArrayBuffer(8));for(let e=0;e<8;e++)r.setUint8(e,parseInt(t.substring(e*2,e*2+2),16));return r.getBigInt64(0)},bytesLength:()=>8,random:t=>{var r,e;let n=R,s=V;typeof((r=t.options)==null?void 0:r.min)<"u"&&(n=BigInt(t.options.min)),typeof((e=t.options)==null?void 0:e.max)<"u"&&(s=BigInt(t.options.max));let o=s-n,i=o.toString(2).length,u;do u=BigInt("0b"+Array.from(crypto.getRandomValues(new Uint8Array(Math.ceil(i/8)))).map(l=>l.toString(2).padStart(8,"0")).join(""));while(u>o);return u+n}},boolean:{serialize:t=>typeof t=="boolean"?t?"01":"00":typeof t=="string"&&t==="true"?"01":"00",deserialize:t=>t!=="00",bytesLength:()=>1,random:()=>Math.random()<.5},color:{serialize:t=>B(t),deserialize:t=>t,bytesLength:()=>4,transform:t=>{let r=B(t),e=parseInt(r.slice(0,2),16),n=parseInt(r.slice(2,4),16),s=parseInt(r.slice(4,6),16),o=parseInt(r.slice(6,8),16);return{hex:{rgb:"#"+t.slice(0,6),rgba:"#"+t},obj:{rgb:{r:e,g:n,b:s},rgba:{r:e,g:n,b:s,a:o}},arr:{rgb:[e,n,s],rgba:[e,n,s,o]}}},constrain:t=>t.replace("#","").slice(0,8).padEnd(8,"f"),random:()=>`${[...Array(8)].map(()=>Math.floor(Math.random()*16).toString(16)).join("")}`},string:{serialize:(t,r)=>{var e;if(!r.version){let o=H(t.substring(0,64));return o=o.padEnd(64*4,"0"),o}let n=64;typeof((e=r.options)==null?void 0:e.maxLength)<"u"&&(n=Number(r.options.maxLength));let s=H(t.substring(0,n));return s=s.padEnd(n*4,"0"),s},deserialize:t=>C(t),bytesLength:t=>{var r;return t.version&&typeof((r=t.options)==null?void 0:r.maxLength)<"u"?Number(t.options.maxLength)*2:64*2},random:t=>{var r,e;let n=0;typeof((r=t.options)==null?void 0:r.minLength)<"u"&&(n=t.options.minLength);let s=64;typeof((e=t.options)==null?void 0:e.maxLength)<"u"&&(s=t.options.maxLength);let o=Math.round(Math.random()*(s-n)+n);return[...Array(o)].map(i=>(~~(Math.random()*36)).toString(36)).join("")},constrain:(t,r)=>{var e,n;let s=0;typeof((e=r.options)==null?void 0:e.minLength)<"u"&&(s=r.options.minLength);let o=64;typeof((n=r.options)==null?void 0:n.maxLength)<"u"&&(o=r.options.maxLength);let i=t.slice(0,o);return i.length<s?i.padEnd(s):i}},bytes:{serialize:(t,r)=>Array.from(t).map(e=>e.toString(16).padStart(2,"0")).join(""),deserialize:(t,r)=>{let e=t.length/2,n=new Uint8Array(e),s;for(let o=0;o<e;o++)s=o*2,n[o]=parseInt(`${t[s]}${t[s+1]}`,16);return n},bytesLength:t=>t.options.length,random:t=>{var r;let e=((r=t.options)==null?void 0:r.length)||0,n=new Uint8Array(e);for(let s=0;s<e;s++)n[s]=Math.random()*255|0;return n}},select:{serialize:(t,r)=>{var e,n;return Math.min(255,((n=(e=r.options)==null?void 0:e.options)==null?void 0:n.indexOf(t))||0).toString(16).padStart(2,"0")},deserialize:(t,r)=>{var e,n,s,o;let i=parseInt(t,16);return((n=(e=r.options)==null?void 0:e.options)==null?void 0:n[i])||((o=(s=r.options)==null?void 0:s.options)==null?void 0:o[0])||""},bytesLength:()=>1,constrain:(t,r)=>r.options.options.includes(t)?t:r.options.options[0],random:t=>{var r;let e=Math.round(Math.random()*(t.options.options.length-1)+0);return(r=t?.options)==null?void 0:r.options[e]}}};function M(t,r){let e="";if(!r)return e;for(let n of r){let{id:s,type:o}=n,i=h[o],u=t[s],l=typeof u<"u"?u:typeof n.default<"u"?n.default:i.random(n),d=i.serialize(l,n);e+=d}return e}function F(t,r,e){let n={};for(let s of r){let o=h[s.type],i=e.withTransform&&o[e.transformType||"transform"];if(!t){let _;typeof s.default>"u"?_=o.random(s):_=s.default,n[s.id]=i?i(_,s):_;continue}let u=o.bytesLength(s),l=t.substring(0,u*2);t=t.substring(u*2);let d=o.deserialize(l,s);n[s.id]=i?i(d,s):d}return n}var w=(t,r,e,n)=>{let s=e.find(u=>u.id===t);if(!s)throw new Error(`No definition found for param ${t}`);let i=h[s.type][n];return i?.(r,s)||r},x=(t,r,e)=>{let n={};for(let s of r){let o=h[s.type],i=t[s.id],u=o[e];n[s.id]=u?.(i,s)||i}return n};function k(t,r){let{parent:e}=t,n=new URLSearchParams(t.location.search),s=n.get("fxhash")||T(),o=g(s),i=n.get("fxminter")||S(),u=g(i),l=n.get("preview")==="1";function d(){t.dispatchEvent(new Event("fxhash-preview")),setTimeout(()=>d(),500)}let $=t.location.hash?.replace("#0x",""),y={_version:"4.0.1",_processors:h,_params:void 0,_features:void 0,_paramValues:{},_listeners:{},_receiveUpdateParams:async function(a,c){let f=await this.propagateEvent("params:update",a);f.forEach(([m,v])=>{typeof m=="boolean"&&!m||(this._updateParams(a),c?.()),v?.(m,a)}),f.length===0&&(this._updateParams(a),c?.())},_updateParams:function(a){let c=x({...this._rawValues,...a},this._params,"constrain");Object.keys(c).forEach(f=>{this._rawValues[f]=c[f]}),this._paramValues=x(this._rawValues,this._params,"transform"),this._updateInputBytes()},_updateInputBytes:function(){let a=M(this._rawValues,this._params);this.inputBytes=a},_emitParams:function(a){let c=Object.keys(a).reduce((f,m)=>(f[m]=w(m,a[m],this._params,"constrain"),f),{});this._receiveUpdateParams(c,()=>{e.postMessage({id:"fxhash_emit:params:update",data:{params:c}},"*")})},hash:s,rand:o,minter:i,randminter:u,iteration:Number(n.get("fxiteration"))||1,context:n.get("fxcontext")||"standalone",preview:d,isPreview:l,params:function(a){this._params=a.map(c=>({...c,version:this._version})),this._rawValues=F($,this._params,{withTransform:!0,transformType:"constrain"}),this._paramValues=x(this._rawValues,this._params,"transform"),this._updateInputBytes()},features:function(a){this._features=a},getFeature:function(a){return this._features[a]},getFeatures:function(){return this._features},getParam:function(a){return this._paramValues[a]},getParams:function(){return this._paramValues},getRawParam:function(a){return this._rawValues[a]},getRawParams:function(){return this._rawValues},getRandomParam:function(a){let c=this._params.find(m=>m.id===a);return h[c.type].random(c)},getDefinitions:function(){return this._params},stringifyParams:function(a){return JSON.stringify(a||this._rawValues,(c,f)=>typeof f=="bigint"?f.toString():f,2)},on:function(a,c,f){return this._listeners[a]||(this._listeners[a]=[]),this._listeners[a].push([c,f]),()=>{let m=this._listeners[a].findIndex(([v])=>v===c);m>-1&&this._listeners[a].splice(m,1)}},propagateEvent:async function(a,c){let f=[];if(this._listeners?.[a])for(let[m,v]of this._listeners[a]){let E=m(c);f.push([E instanceof Promise?await E:E,v])}return f},emit:function(a,c){switch(a){case"params:update":this._emitParams(c);break;default:console.log("$fx.emit called with unknown id:",a);break}}},N=()=>{o=g(s),y.rand=o,o.reset=N};o.reset=N;let z=()=>{u=g(i),y.randminter=u,u.reset=z};return u.reset=z,t.addEventListener("message",a=>{if(a.data==="fxhash_getInfo"&&e.postMessage({id:"fxhash_getInfo",data:{version:t.$fx._version,hash:t.$fx.hash,iteration:t.$fx.iteration,features:t.$fx.getFeatures(),params:{definitions:t.$fx.getDefinitions(),values:t.$fx.getRawParams()},minter:t.$fx.minter}},"*"),a.data?.id==="fxhash_params:update"){let{params:c}=a.data.data;c&&t.$fx._receiveUpdateParams(c)}}),y}window.$fx=k(window,{});})();
